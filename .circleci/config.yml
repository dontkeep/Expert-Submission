version: 2.1

orbs:
  android: circleci/android@1.0.2  # Updated orb version

executors:
  android-java17:
    docker:
      - image: cimg/android:2023.09.1  # Official Android image with JDK 17

jobs:
  build:
    executor: android-java17
    steps:
      - checkout
      
      - android/install-sdk:
          api-level: 34
          build-tools-version: 34.0.0
          components: "platforms;android-34,platform-tools"
      
      - run:
          name: Accept Licenses
          command: |
            yes | $ANDROID_HOME/tools/bin/sdkmanager --licenses

      - restore_cache:
          keys:
            - v3-dependencies-{{ checksum "build.gradle" }}
            - v3-dependencies-

      - run:
          name: Build Project
          command: ./gradlew build

      - save_cache:
          paths:
            - ~/.gradle
            - ~/.android
          key: v3-dependencies-{{ checksum "build.gradle" }}

      - store_artifacts:
          path: app/build/outputs/apk/debug
          destination: apk

      - store_test_results:
          path: app/build/test-results
